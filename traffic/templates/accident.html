
{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Report an Accident{% endblock title %}

{% block content %}

<br>

<div class="container" style="    display: flex;
    justify-content: center;">
<div class="card text-center" style="width: 50rem;">
  <h3 class="card-header bg-white">Report an Accident</h3>
  <div class="card-body">

        <form action="{% url 'create-accident' %}" method="POST" enctype="multipart/form-data">
            <p>Please Provide Involved People Civil ID Numbers</p>
            <br>
            {% csrf_token %}
            {{involvedFormset.management_form}}
            {% for form in involvedFormset %}
                {{popForm|crispy}}
                {{form|crispy}}
            {% endfor %}
    <br>
    
            <h3>Location</h3>
            <div id="mapholder"></div>

            <button id="location" onclick="showLocation()" class="btn btn-outline-warning">Attach Location</button>
            <br>
        {{accidentForm|crispy}}
        <br>

        <h3>Car Registeration</h3>
        {{registrationFormset.management_form}}
        {% for form in registrationFormset %}
            {{form|crispy}}
        {% endfor %}

        <br>
       
    	<div>
    		<h3>Car accident images</h3>
        	{{car_images_form|crispy}}
    	</div>
          <br>
        <input type="submit" value="Report" class="btn btn-outline-warning">
    </form>

</div>
</div>
</div>
<script>

function showLocation() {
    if (navigator.geolocation.getCurrentPosition(showPosition)) {
        position=navigator.geolocation.getCurrentPosition(showPosition)
        showPosition(position)
    }
    else if(!navigator.geolocation){

        document.getElementById("mapholder").innerHTML =  "<p>Geolocation is not supported by this browser.</p>";
    }
}
function showPosition(position) {

       
        var latlon = position.coords.latitude + "," + position.coords.longitude;
        var img_url = "https://maps.googleapis.com/maps/api/staticmap?center="+latlon+"&zoom=18&size=400x300&sensor=false&key=AIzaSyDZG-gtTFCZ2SProv9zW0vM_97ZEVK9a1s";

document.getElementById("id_location_longitude").value=position.coords.longitude.toFixed(6)
document.getElementById("id_location_latitude").value=position.coords.latitude.toFixed(6)
document.getElementById("mapholder").innerHTML = "<img src='"+img_url+"'>";
   
}

</script>



	{% endblock %}


